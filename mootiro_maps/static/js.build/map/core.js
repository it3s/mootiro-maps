(function(){var e=Array.prototype.indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},t=Array.prototype.slice;define(["require","jquery","underscore","backbone"],function(n){var r,i,s,o,u;return r=n("jquery"),u=n("underscore"),i=n("backbone"),s=function(){function s(){this._components={},this._hooks={},this._pubQueue=[],this._pubsub={},u.extend(this._pubsub,i.Events)}return s.prototype.loading=0,s.prototype.data={deferred:r.Deferred,when:r.when},s.prototype._getComponent=function(e,t){var n,r;n=(r=this._components[e])!=null?r:{};if(n[t]==null)throw new Error("Could not be found a component '"+e+"' with id '"+t+"'");return n[t]},s.prototype._removeComponent=function(e,t){var n;return(n=this._components[e])!=null?delete n[t]:void 0},s.prototype.registerHook=function(t,n,r){var i;r==null&&(r=null),(i=this._hooks)[t]==null&&(i[t]=[]);if(!(e.call(this._hooks[t],n)>=0))return this._hooks[t].push(u.bind(n,r))},s.prototype.unregisterHook=function(e,t){},s.prototype.triggerHooks=function(){var e,n,r,i,s,o,u,a;e=arguments[0],r=2<=arguments.length?t.call(arguments,1):[],a=(u=this._hooks[e])!=null?u:[];for(s=0,o=a.length;s<o;s++)n=a[s],i=n.apply(null,r),r=i;return r},s.prototype.load=function(e,t,r){var i,s,o,u,a,f=this;return a=t,o=e.split("::"),i=o[0],s=o[1],u=this.data.deferred(),n([i],function(n){var i,o;i=n[s];try{o=new i(f,t)}catch(l){typeof console!="undefined"&&console!==null&&console.error(l.message),typeof console!="undefined"&&console!==null&&console.warn("Could not initialize component '"+e+"'"),u.resolve();return}return o.type=r.type,f.data.when(o.init(r)).done(function(){var t,n,r;f._components[e][a].instance=o,r=o.hooks;for(t in r)n=r[t],o[n]!=null&&f.registerHook(t,o[n],o);return typeof console!="undefined"&&console!==null&&console.log("Component '"+e+"' initialized"),f.publish(""+s+":started",a),u.resolve(o)}).fail(function(){return typeof console!="undefined"&&console!==null&&console.warn("Could not initialize component '"+e+"'"),u.resolve(o)})},function(t){var r;return t.requireType==="timeout"?typeof console!="undefined"&&console!==null&&console.warn("Could not load module '"+t.requireModules+"'"):(r=t.requireModules&&t.requireModules[0],n.undef(r),typeof console!="undefined"&&console!==null&&console.error(t.message),typeof console!="undefined"&&console!==null&&console.warn("Could not initialize component '"+e+"'")),u.resolve()}),u.promise()},s.prototype.unload=function(e){},s.prototype.start=function(e,t,n){var i,s,o,a,f,l,c,h,p,d,v,m=this;n==null&&(n={}),u.isString(e)?s=[{component:e,el:t,opts:n}]:u.isArray(e)?s=e:s=[e];if(!u.isArray(s))throw new Error("componentList must be defined as an array");c=[];for(d=0,v=s.length;d<v;d++)l=s[d],i=l.component,t=l.el,n=l.opts,this.loading++,f=t,(p=this._components)[i]==null&&(p[i]={}),o=this._components[i],o[f]!=null&&typeof console!="undefined"&&console!==null&&console.error("Conflict: already exists one component '"+i+"' with id '"+f+"' "),this._components[i][f]={el:t,opts:n},a=this.data.deferred(),c.push(this.load(i,t,n));return h=this.data.when.apply(r,c),h.done(function(){return m.loading-=arguments.length,m._processPublishQueue()}),h},s.prototype.stop=function(e,t){var n,i,s,o,a,f,l,c,h;a=t,f=u.isArray(a)?a:[a],s=this.data.deferred(),l=f.length,o=0;for(c=0,h=f.length;c<h;c++)n=f[c],i=this._getComponent(e,n),i.instance.destroy().done(function(){r(i.el).children().remove(),this._removeComponent(e,n),o++;if(o===l)return s.resolve()});return s.promise()},s.prototype.publish=function(e){return this._addToPublishQueue.apply(this,arguments),this._processPublishQueue()},s.prototype.subscribe=function(e,t,n){return this._pubsub.on(e,t,n)},s.prototype._addToPublishQueue=function(e){return this._pubQueue.push(arguments)},s.prototype._processPublishQueue=function(){var e;if(this.loading>0)return!1;e=this._pubQueue.shift();if(e!=null)return this._pubsub.trigger.apply(this._pubsub,e),this._processPublishQueue()},s}(),o={Mediator:s},o})}).call(this);