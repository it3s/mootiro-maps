(function(){var e=Object.prototype.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define(["require","googlemaps","./common","./multimarker","./multipolyline"],function(e){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S;return E=e("googlemaps"),b=e("./common"),e("./multimarker"),e("./multipolyline"),window.komoo==null&&(window.komoo={}),(S=window.komoo).event==null&&(S.event=E.event),n=b.geometries.types.EMPTY,p=b.geometries.types.POINT,f=b.geometries.types.MULTIPOINT,d=b.geometries.types.POLYGON,v=b.geometries.types.LINESTRING,s=b.geometries.types.LINESTRING,l=b.geometries.types.MULTILINESTRING,a=b.geometries.types.MULTILINESTRING,u=510072000000001,w={BACKGROUND_COLOR:"#000",BACKGROUND_OPACITY:.6,BORDER_COLOR:"#000",BORDER_OPACITY:.6,BORDER_SIZE:1.5,BORDER_SIZE_HOVER:2.5,ZINDEX:1},i=function(){function e(e){var t;this.options=e!=null?e:{},this.setFeature(this.options.feature),this.area=(t=this.options.area)!=null?t:0,this.initOverlay(this.options)}return e.prototype.initOverlay=function(e){throw"Not Implemented"},e.prototype.getCoordinates=function(){throw"Not Implemented"},e.prototype.setCoordinates=function(e){return komoo.event.trigger(this,"coordinates_changed")},e.prototype.setEditable=function(e){throw"Not Implemented"},e.prototype.initEvents=function(e){var t,n=this;e==null&&(e=this.overlay);if(!e)return;return t=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","rightclick"],t.forEach(function(t){return komoo.event.addListener(e,t,function(e,r){return komoo.event.trigger(n,t,e,r)})})},e.prototype.calculateBounds=function(){var e,t,n,r,i,s,o,u,a,f,c,h,p,v;s=a=f=n=null,i=function(e){return s==null&&(s=a!=null?a:a=e[0]),f==null&&(f=n!=null?n:n=e[1]),s=Math.max(e[0],s),a=Math.min(e[0],a),f=Math.min(e[1],f),n=Math.max(e[1],n),[[a,f],[s,n]]},t=this.getCoordinates(),r=this.getGeometryType(),r!==d&&r!==l&&(t=[t]);for(c=0,p=t.length;c<p;c++){o=t[c];for(h=0,v=o.length;h<v;h++)u=o[h],e=i(u)}return e!=null&&(this.bounds=new E.LatLngBounds(this.getLatLngFromArray(e[0]),this.getLatLngFromArray(e[1]))),this.bounds},e.prototype.getBounds=function(){return this.bounds!=null?this.bounds:this.calculateBounds()},e.prototype.getCenter=function(){var e,t,n;return this.overlay?this.getArrayFromLatLng((typeof (e=this.overlay).getCenter=="function"?e.getCenter():void 0)||((n=this.getBounds())!=null?n.getCenter():void 0)||(typeof (t=this.overlay).getPosition=="function"?t.getPosition():void 0)):[]},e.prototype.getOverlay=function(){return this.overlay},e.prototype.setOverlay=function(e){return this.overlay=e,this.initEvents()},e.prototype.getFeature=function(){return this.feature},e.prototype.setFeature=function(e){this.feature=e},e.prototype.getGeometryType=function(){return this.geometryType},e.prototype.getDefaultZIndex=function(){var e;return((e=this.feature)!=null?e.getDefaultZIndex():void 0)||w.ZINDEX},e.prototype.getLatLngFromArray=function(e){return e!=null?new E.LatLng(e[0],e[1]):null},e.prototype.getArrayFromLatLng=function(e){return e?[e.lat(),e.lng()]:[]},e.prototype.getLatLngArrayFromArray=function(e){var t,n,r,i;i=[];for(n=0,r=e.length;n<r;n++)t=e[n],i.push(this.getLatLngFromArray(t));return i},e.prototype.getArrayFromLatLngArray=function(e){var t,n,r,i;if(e){i=[];for(n=0,r=e.length;n<r;n++)t=e[n],i.push(this.getArrayFromLatLng(t));return i}return[]},e.prototype.getMap=function(){return this.map},e.prototype.setMap=function(e){var t;return this.map=e,(t=this.overlay)!=null?t.setMap(this.map&&this.map.googleMap?this.map.googleMap:this.map):void 0},e.prototype.getVisible=function(){var e;return(e=this.overlay)!=null?e.getVisible():void 0},e.prototype.setVisible=function(e){var t;return(t=this.overlay)!=null?t.setVisible(e):void 0},e.prototype.setOptions=function(e){var t;return this.options=e,(t=this.overlay)!=null?t.setOptions(this.options):void 0},e.prototype.getIcon=function(){var e;return(e=this.overlay)!=null?typeof e.getIcon=="function"?e.getIcon():void 0:void 0},e.prototype.setIcon=function(e){var t;return(t=this.overlay)!=null?typeof t.setIcon=="function"?t.setIcon(e):void 0:void 0},e.prototype.getIconUrl=function(e){var t;return(t=this.feature)!=null?t.getIconUrl(e):void 0},e.prototype.getGeoJson=function(){return{type:this.getGeometryType(),coordinates:this.getCoordinates()}},e}(),r=function(e){function r(){r.__super__.constructor.apply(this,arguments)}return t(r,e),r.prototype.geometryType=n,r.prototype.getOverlayOptions=function(e){return{}},r.prototype.initOverlay=function(e){return this.options=e!=null?e:{},!0},r.prototype.getCoordinates=function(){return[]},r.prototype.setEditable=function(e){return!0},r.prototype.getGeoJson=function(){return null},r}(i),m=function(e){function n(){n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.geometryType=p,n.prototype.getOverlayOptions=function(e){var t,n,r;return e==null&&(e={}),{clickable:(t=e.clickable)!=null?t:!0,zIndex:(n=e.zIndex)!=null?n:u,icon:(r=e.icon)!=null?r:this.getIconUrl(e.zoom)}},n.prototype.initOverlay=function(e){return this.setOverlay(new E.Marker(this.getOverlayOptions(e)))},n.prototype.initEvents=function(e){var t,r=this;return e==null&&(e=this.overlay),n.__super__.initEvents.call(this,e),t=["animation_changed","clickable_changed","cursor_changed","drag","dragend","daggable_changed","dragstart","flat_changed","icon_changed","position_changed","shadow_changed","shape_changed","title_changed","visible_changed","zindex_changed"],t.forEach(function(t){return komoo.event.addListener(e,t,function(e,n){return komoo.event.trigger(r,t,e,n)})})},n.prototype.getCoordinates=function(){return this.getArrayFromLatLng(this.overlay.getPosition())},n.prototype.setCoordinates=function(e){return this.bounds=null,this.overlay.setPosition(this.getLatLngFromArray(e)),n.__super__.setCoordinates.call(this,e)},n.prototype.setEditable=function(e){return this.overlay.setDraggable(e)},n.prototype.getPosition=function(){return this.overlay.getPosition()},n.prototype.setPosition=function(e){return this.overlay.setPosition(e instanceof Array?this.getLatLngFromArray(e):e)},n.prototype.addMarker=function(e){return this.setOverlay(e)},n}(i),h=function(e){function n(){n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.geometryType=f,n.prototype.getOverlayOptions=function(e){var t,n,r;return e==null&&(e={}),{clickable:(t=e.clickable)!=null?t:!0,zIndex:(n=e.zIndex)!=null?n:u,icon:(r=e.icon)!=null?r:this.getIconUrl(e.zoom)}},n.prototype.initOverlay=function(e){return this.setOverlay(new MultiMarker(this.getOverlayOptions(e)))},n.prototype.getPoints=function(){return this.overlay.getMarkers().getArray()},n.prototype.setPoints=function(e){return this.overlay.addMarkers(e)},n.prototype.guaranteePoints=function(e){var t,n,r,i,s,o;n=this.overlay.getMarkers();if(n.length>=e){s=[];for(t=0,r=n.length-e-1;0<=r?t<=r:t>=r;0<=r?t++:t--)s.push(n.pop());return s}o=[];for(t=0,i=e-n.length-1;0<=i?t<=i:t>=i;0<=i?t++:t--)o.push(this.overlay.addMarker(new E.Marker(this.options)));return o},n.prototype.getCoordinates=function(){var e,t,n,r,i;r=this.getPoints(),i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(this.getArrayFromLatLng(e.getPosition()));return i},n.prototype.setCoordinates=function(e){var t,r,i,s;e[0]instanceof Array||(e=[e]),this.guaranteePoints(e.length),this.bounds=null,s=this.getPoints();for(t=0,i=s.length;t<i;t++)r=s[t],r.setPosition(this.getLatLngFromArray(e[t]));return n.__super__.setCoordinates.call(this,e)},n.prototype.setEditable=function(e){return this.overlay.setDraggable(e)},n.prototype.getPositions=function(){var e,t,n,r,i;r=this.getPoints(),i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e.getPosition());return i},n.prototype.setPositions=function(e){return this.overlay.setPositions(e)},n.prototype.getMarkers=function(){return this.overlay.getMarkers()},n.prototype.addMarkers=function(e){return this.overlay.addMarkers(e)},n.prototype.addMarker=function(e){return this.overlay.addMarker(e)},n}(i),y=function(e){function n(){n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.geometryType=p,n.prototype.getGeoJson=function(){return{type:f,coordinates:this.getCoordinates()}},n}(h),o=function(e){function n(e){n.__super__.constructor.call(this,e),this.handleEvents()}return t(n,e),n.prototype.geometryType=s,n.prototype.getOverlayOptions=function(e){var t,n,r,i,s;return e==null&&(e={}),{clickable:(t=e.clickable)!=null?t:!0,zIndex:(n=e.zIndex)!=null?n:u,strokeColor:(r=e.strokeColor)!=null?r:this.getBorderColor(),strokOpacity:(i=e.strokeOpacity)!=null?i:this.getBorderOpacity(),strokeWeight:(s=e.strokeWeight)!=null?s:this.getBorderSize()}},n.prototype.initOverlay=function(e){return this.setOverlay(new E.Polyline(this.getOverlayOptions(e)))},n.prototype.handleEvents=function(){var e=this;return komoo.event.addListener(this,"mousemove",function(t){return e.setOptions({strokeWeight:e.getBorderSizeHover()})}),komoo.event.addListener(this,"mouseout",function(t){return e.setOptions({strokeWeight:e.getBorderSize()})})},n.prototype.getCoordinates=function(){var e,t,n,r,i;r=this.overlay.getPath().getArray(),i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(this.getArrayFromLatLng(e));return i},n.prototype.setCoordinates=function(e){var t;return this.overlay.setPath(function(){var n,r,i;i=[];for(n=0,r=e.length;n<r;n++)t=e[n],i.push(this.getLatLngFromArray(t));return i}.call(this))},n.prototype.setEditable=function(e){return this.overlay.setEditable(e)},n.prototype.getBorderColor=function(){var e;return((e=this.feature)!=null?e.getBorderColor():void 0)||w.BORDER_COLOR},n.prototype.getBorderOpacity=function(){var e;return((e=this.feature)!=null?e.getBorderOpacity():void 0)||w.BORDER_OPACITY},n.prototype.getBorderSize=function(){var e;return((e=this.feature)!=null?e.getBorderSize():void 0)||w.BORDER_SIZE},n.prototype.getBorderSizeHover=function(){var e;return((e=this.feature)!=null?e.getBorderSizeHover():void 0)||w.BORDER_SIZE_HOVER},n.prototype.getPath=function(){return this.overlay.getPath()},n.prototype.setPath=function(e){return this.overlay.setPath(e)},n}(i),c=function(e){function n(){n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.geometryType=l,n.prototype.initOverlay=function(e){return this.setOverlay(new MultiPolyline(this.getOverlayOptions(e)))},n.prototype.guaranteeLines=function(e){var t,n,r,i,s,o;n=this.overlay.getPolylines();if(n.length>=e){s=[];for(t=0,r=n.length-e-1;0<=r?t<=r:t>=r;0<=r?t++:t--)s.push(n.pop());return s}o=[];for(t=0,i=e-n.length-1;0<=i?t<=i:t>=i;0<=i?t++:t--)o.push(this.overlay.addPolyline(new E.Polyline(this.options)));return o},n.prototype.getCoordinates=function(){var e,t,n,r,i;r=this.overlay.getPolylines().getArray(),i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(this.getArrayFromLatLngArray(e.getPath().getArray()));return i},n.prototype.setCoordinates=function(e){var t,n,r,i,s;e[0][0]instanceof Array||(e=[e]),this.guaranteeLines(e.length),this.bounds=null,i=this.getLines(),s=[];for(t=0,r=i.length;t<r;t++)n=i[t],s.push(n.setPath(this.getLatLngArrayFromArray(e[t])));return s},n.prototype.getBorderSize=function(){return n.__super__.getBorderSize.call(this)+1},n.prototype.getBorderSizeHover=function(){return n.__super__.getBorderSizeHover.call(this)+1},n.prototype.getPath=function(){return this.getPaths().getAt(0)},n.prototype.getPaths=function(){return this.overlay.getPaths()},n.prototype.setPaths=function(e){return this.overlay.setPaths(e)},n.prototype.getLines=function(){return this.overlay.getPolylines().getArray()},n.prototype.setLines=function(e){return this.overlay.addPolylines(e)},n.prototype.addPolyline=function(e,t){return this.overlay.addPolyline(e,t)},n.prototype.getPolylines=function(){return this.overlay.getPolylines()},n}(o),g=function(e){function n(){n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.geometryType=d,n.prototype.getOverlayOptions=function(e){var t,n,r,i,s,o,u;return e==null&&(e={}),{clickable:(t=e.clickable)!=null?t:!0,zIndex:(n=e.zIndex)!=null?n:this.calculateZIndex(),fillColor:(r=e.fillColor)!=null?r:this.getBackgroundColor(),fillOpacity:(i=e.fillOpacity)!=null?i:this.getBackgroundOpacity(),strokeColor:(s=e.strokeColor)!=null?s:this.getBorderColor(),strokeOpacity:(o=e.strokeOpacity)!=null?o:this.getBorderOpacity(),strokeWeight:(u=e.strokeWeight)!=null?u:this.getBorderSize()}},n.prototype.calculateZIndex=function(){return this.area?510072e9/this.area:this.getDefaultZIndex()},n.prototype.initOverlay=function(e){return this.setOverlay(new E.Polygon(this.getOverlayOptions(e)))},n.prototype.getBackgroundColor=function(){var e;return((e=this.feature)!=null?e.getBackgroundColor():void 0)||w.BACKGROUND_COLOR},n.prototype.getBackgroundOpacity=function(){var e;return((e=this.feature)!=null?e.getBackgroundOpacity():void 0)||w.BACKGROUND_OPACITY},n.prototype.getCoordinates=function(){var e,t,n,r,i,s;e=[],s=this.overlay.getPaths().getArray();for(r=0,i=s.length;r<i;r++)t=s[r],n=this.getArrayFromLatLngArray(t.getArray()),n.length&&n.push(n[0]),n.length>0&&e.push(n);return e},n.prototype.setCoordinates=function(e){var t,n,r,i,s;n=[],this.bounds=null;for(i=0,s=e.length;i<s;i++)r=e[i],t=this.getLatLngArrayFromArray(r),t.pop(),n.push(t);return this.setPaths(n)},n.prototype.getPath=function(){return this.getPaths().getAt(0)},n.prototype.getPaths=function(){return this.overlay.getPaths()},n.prototype.setPaths=function(e){return this.overlay.setPaths(e)},n}(o),window.komoo.geometries={types:{EMPTY:n,POINT:p,MULTIPOINT:f,POLYGON:d,POLYLINE:v,LINESTRING:s,MULTIPOLYLINE:l,MULTILINESTRING:a},MultiMarker:MultiMarker,Geometry:i,Empty:r,Point:y,MultiPoint:h,LineString:o,MultiLineString:c,Polygon:g,defaults:w,makeGeometry:function(e,t){var n,i,s,o,u;s={feature:t,area:(u=e.properties)!=null?u.area:void 0};if(e.geometry==null)return new r(s);o=e.geometry.type,n=e.geometry.coordinates;if(o==="Point")i=new y(s);else if(o==="MultiPoint"||o==="marker")i=new h(s);else if(o==="LineString"||o==="polyline")n&&(n=[n]),i=new c(s);else if(o==="MultiLineString")i=new c(s);else if(o==="Polygon"||o==="polygon")i=new g(s);return n&&i!=null&&i.setCoordinates(n),i}},window.komoo.geometries})}).call(this);