(function(e){comments=function(){var t=e(".btnShowForm"),n=e(".link_subcomments"),r=e(".btnFormCommentSubmit"),i=e(".btnShowMore"),s=0,o=e("#formComment").find("input[name=csrfmiddlewaretoken]").val(),u=function(){t.live("click",function(t){var n;t.preventDefault(),n=e(t.target).siblings(".comment-form"),(!n.parent().siblings(".comments-list").length||n.parent().siblings(".comments-list").is(":hidden"))&&a(e(t.target).siblings(".link_subcomments")),n.slideToggle("fast")}),n.live("click",function(t){t.preventDefault();var n=e(t.target);a(n)}),r.live("click",function(t){var n,r;t.preventDefault();for(r=e(t.target);!r.is("form");r=r.parent());n=r,e.ajax({url:n.attr("action"),type:"POST",data:n.serialize(),success:function(t){var i,s;if(t.success){if(n.parent().parent().is("#divFormComment"))e(".comments-list:first").prepend(t.comment);else{for(;!r.is(".comment-container");r=r.parent());i=r,s=i.find(".comments-list"),s.prepend(t.comment),i.hasClass("odd")?s.find(".comment-container:first").addClass("inner-comment"):s.find(".comment-container:first").addClass("odd inner-comment")}n.parent().slideToggle("fast"),n.find("#id_comment").clearForm(),n.find(".comment_markdown").clearForm()}else t.errors.comment&&alert(t.errors.comment)},dataType:"json",complete:function(e){if(e.status===0||e.status===302)window.location.pathname="/user/login?next="+window.location.pathname}})}),i.live("click",function(t){t.preventDefault();var n=load_info;n.page=++s,n.wrap=0,e.get("/comments/load",n,function(t){e(".comments-list:first").append(t.comments)})})},a=function(t){var n,r,i;for(n=t;!n.is(".comment-container");n=n.parent());r=n;if(r.find(".comments-list").length){i=r.find(".comments-list:first");if(!i.is(":hidden"))return i.slideToggle(),!1;i.remove()}e.get("/comments/load",{parent_id:t.attr("comment-id")},function(e){r.append(e.comments),r.hasClass("odd")||r.find(".comment-container").addClass("odd"),r.find(".comments-list").addClass("inner-list").slideToggle("fast")})};return{init:u}}(),e(function(){comments.init()})})(jQuery)